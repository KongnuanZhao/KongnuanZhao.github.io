title: 计算机体系结构/内存结构
date: 2015-01-07 09:01:11
author: 赵空暖
tags: 操作系统
categories: 操作系统
---
![kimi](/image/kimi.png)
> 为什么要学操作系统？因为他很酷！我们可以现在不酷，但是追求酷的心不能没有！O(∩_∩)O~   
　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　--by赵空暖

#课堂笔记#
##计算机基本硬件结构##
![os](/image/os.png)
##内存的层次机构##
CPU要访问的指令或者数据所处的位置
![neicun](/image/neicun.png)
##操作系统如何管理内存##
* 抽象：逻辑地址空间
* 保护：独立地址空间
* 共享：访问相同内存
* 虚拟化：更多的地址空间，linux上的swap
![ppp](/image/PPP.png)
这张图展示了物理地址空间和逻辑地址空间之间的关系，那么什么是地址空间？
* 什么是地址空间？
	* 什么是物理地址空间？--和硬件直接对应的地址空间。
	起始地址0，直到MAXsys。
	![physicaladd](/image/physicaladd.png)
	* 什么是逻辑地址空间？--一个程序所拥有的内存范围。例如在进行C语言指针编程中，可以读取指针变量本身值(&操作)，实际上这个值就是逻辑地址，它是相对于你当前进程数据段的地址，不和绝对物理地址相干。
	![logicadd](/image/logicadd.png)
* 地址空间是怎么生成的？
	* 物理地址空间生成
	起始地址0，地址从0开始编号，顺序地每次加1，直到MAXsys，因此存储器的物理地址空间是呈线性增长的。它是用二进制数来表示的，是无符号整数，书写格式为十六进制数。
	* 逻辑地址空间产生
	![logicaddress](/image/logicaddress.png)
	<b>问：逻辑地址是在编译的时候产生还是链接的时候产生的呢</b>
	Compilers and assemblers generate code and data sections that start at address zero. The linker relocates these sections by associating a memory location with each symbol definition, and then modifying all of the references to those symbols so that they point to this memory location.
	编译器和汇编器生成的代码和数据段的开始地址。链接器重新定位这些部分关联的内存位置与每个符号的定义，然后修改所有这些符号的引用，指向该内存位置。所以说是链接的时候产生。
	* 地址的生成流程
		* 编译时
			* 假设起始地址已知
			* 如果起始地址改变，必须重新编译
		* 加载时
			* 如果编译时刻起始位置未知，那么编译器必须生成可重定位的代码(relocatablecode)
			* 加载时，生成绝对地址
		* 执行时
			* 程序可以被移动，例如暂时不运行的先放到虚拟内存即硬盘中
			* 需要地址翻译的硬件支持
	* 关于编译器的工作过程，请参看阮一峰的[编译器的工作过程](http://www.ruanyifeng.com/blog/2014/11/compiler.html) 讲解的甚是详细。
* 逻辑地址空间和物理地址空间的区别和联系？
当我们的cpu需要某条指令的时候，会发出请求参数是逻辑地址空间，cpu里面的MMU会去查找映射表中是否存在逻辑地址所对应的物理地址，如果有，直接找到，如果没有就会产生去内存的map去找。找到了之后会向主存发出一个请求，我需要这个地址里面的内容。之后我们的主存会把所需要的内容通过主线传给我们的CPU，CPU拿到之后就可以对这条指令进项执行了。这里面操作系统的作用在于把逻辑地址和物理地址的对应关系建好，这个对应关系可以放在缓存。
![address](/image/address.png)
* 操作系统是如何管理地址空间，而使得程序之间能够不受干扰？
操作系统去建立和维护程序的起始地址和长度，一旦超出了这个程度的地址范围则产生一个异常，此异常的处理也交由操作系统来处理。这个过程也称为地址安全检查。
![addresscheck](/image/addresscheck.png)
* 内存是如何分配的？
	* 连续内存分配
	* 非连续内存分配
下篇文章整理吧[操作系统之内存管理篇](http://www.zhaokongnuan.com/2015/01/07/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E4%B9%8B%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E7%AF%87/)

(图片来源：[清华大学陈瑜老师操作系统公开课](http://www.topu.com/kvideo.php?do=course_progress&kvideoid=4100&classesid=808))